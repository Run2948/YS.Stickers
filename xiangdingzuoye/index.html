<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>简约清爽文字小贴纸许愿墙jquery特效代码</title>
    <meta name="keywords" content="简约,清爽,文字,小贴纸,许愿墙,jquery特效,特效代码">
    <meta name="description" content="简约清爽文字小贴纸许愿墙jquery特效代码，输入文字，按Enter键即可发布心愿到许愿墙。">
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link href="css/jquery.image-label.css" rel="stylesheet">
</head>
<body>
    <div class="btn-group-vertical" style="position:absolute;top:5%;left:1%;">
        <button type="button" class="btn btn-success demo" data-src="云梯车.png">云梯车</button>
        <button type="button" class="btn btn-success demo" data-src="人侧.png">人侧</button>
        <button type="button" class="btn btn-success demo" data-src="人正.png">人正</button>
        <button type="button" class="btn btn-success demo" data-src="分水器.png">分水器</button>
        <button type="button" class="btn btn-success demo" data-src="抢险救援车.png">抢险救援车</button>
        <button type="button" class="btn btn-success demo" data-src="指挥部.png">指挥部</button>
        <button type="button" class="btn btn-success demo" data-src="挖掘机.png">挖掘机</button>
        <button type="button" class="btn btn-success demo" data-src="排烟.png">排烟</button>
        <button type="button" class="btn btn-success demo" data-src="水罐车.png">水罐车</button>
        <button type="button" class="btn btn-success demo" data-src="消防炮.png">消防炮</button>
        <button type="button" class="btn btn-success demo" data-src="高喷.png">高喷</button>
        <button id="btnClear" type="button" class="btn btn-primary">清除</button>
        <button id="btnSave" type="button" class="btn btn-primary">保存</button>
    </div>
    <div id="container" style="background-image:url(../demo.jpg);">
    </div>
    <script src="http://www.jsdaima.com/Upload/1486280073/jquery-3.1.1.min.js"></script>
    <script src="https://cdn.bootcss.com/json2/20160511/json2.min.js"></script>
    <script type="text/javascript">
        (function ($) {

            var container;

            // 可选颜色
            var colors = ['#96C2F1', '#BBE1F1', '#E3E197', '#F8B3D0', '#FFCC00'];

            var debug = function (o) {
                if (window.console && window.console.log) {
                    console.log(o);
                }
            };

            var fire = function (key, elem, opts) {
                if (typeof key == 'string') {
                    if (this[key]) {
                        return this[key](elem, opts);
                    } else {
                        this.debug('function [' + key + '] undefined');
                    }
                }
            };

            // 新建
            var createItem = function (opts) {
                var _ind = container.find('.item').length;
                _ind++;
                var _top = container.get(0).offsetTop + 10 + _ind * 20;
                var _left = container.get(0).offsetLeft - 100;
                var _color = colors[parseInt(Math.random() * 5, 10)]
                opts = $.extend({
                    index: _ind,
                    text: '标记',
                    top: _top,
                    left: _left,
                    color: _color
                }, opts);
                var _class = 'item-' + _ind;
                var _text = opts.text;
                //var _labelHtml = '<div _index="' + _ind + '" class="item ' + _class + '"><p>' + _text + '</p><a href="javascript:void(0)">关闭</a></div>';
                var _labelHtml = '<div _index="' + _ind + '" class="item ' + _class + '"><img src="' + _text + '"/></div>';
                $(_labelHtml).appendTo(container).drag();
                var _label = container.find('.' + _class);
                _label.css({
                    top: opts.top,
                    left: opts.left,
                    //background: opts.color
                });
                _label.attr('_top', opts.top);
                _label.attr('_left', opts.left);
                _label.attr('_color', opts.color);
            };

            var loadData = function (opts) {
                $(opts.data).each(function (i, item) {
                    //var _labelHtml = '<div _index="' + item.index + '" class="item item-' + item.index + '" style="top:' + item.top + 'px;left:' + item.left + 'px;background:' + item.color + '" _top="' + item.top + '" _left="' + item.left + '" _color="' + item.color + '"><p>' + item.text + '</p><a href="javascript:void(0)">关闭</a></div>';
                    var _labelHtml = '<div _index="' + item.index + '" class="item item-' + item.index + '" style="top:' + item.top + 'px;left:' + item.left + 'px;" _top="' + item.top + '" _left="' + item.left + '" _color="' + item.color + '"><img src="' + item.text + '"/></div>';
                    $(_labelHtml).appendTo(container).drag();
                });
            }

            var getData = function () {
                var _arr = [];
                var _labelArr = container.find('.item');
                $(_labelArr).each(function (i, _label) {
                    var _json = {};
                    //_json.text = $(_label).find('p').html();
                    _json.text = $(_label).find('img').attr('src');
                    _json.index = $(_label).attr('_index');
                    _json.top = $(_label).attr('_top');
                    _json.left = $(_label).attr('_left');
                    _json.color = $(_label).attr('_color');
                    _arr.push(_json);
                });
                return _arr;
            }

            var hide = function () {
                container.find('.item').hide();
            };

            var show = function () {
                container.find('.item').show();
            };

            var clear = function () {
                var _labelArr = container.find('.item');
                if (_labelArr.length > 0) {
                    if (window.confirm('确定要删除全部标记吗?')) {
                        $(_labelArr).each(function (i, _label) {
                            $(_label).remove();
                        });
                    }
                }
            };
            /**
             * 定义拖拽函数
             */
            $.fn.drag = function () {

                var $this = $(this);
                var parent = $this.parent();

                var pw = parent.width();
                var ph = parent.height();
                var thisWidth = $this.width() + parseInt($this.css('padding-left'), 10) + parseInt($this.css('padding-right'), 10);
                var thisHeight = $this.height() + parseInt($this.css('padding-top'), 10) + parseInt($this.css('padding-bottom'), 10);

                var x, y, positionX, positionY;
                var isDown = false;

                parent.css({
                    "position": "relative",
                    "overflow": "hidden"
                });

                $this.css({
                    "cursor": "move",
                    "position": "absolute"
                }).mousedown(function (e) {
                    parent.children().css({
                        "zIndex": "0"
                    });
                    $this.css({
                        "zIndex": "1"
                    });
                    isDown = true;
                    x = e.pageX;
                    y = e.pageY;
                    positionX = $this.position().left;
                    positionY = $this.position().top;
                    return false;
                });

                $(document).mouseup(function (e) {
                    isDown = false;
                }).mousemove(function (e) {

                    var xPage = e.pageX;
                    var moveX = positionX + xPage - x;

                    var yPage = e.pageY;
                    var moveY = positionY + yPage - y;

                    if (isDown == true) {
                        $this.css({
                            left: moveX,
                            top: moveY
                        });
                        $this.attr('_top', moveY);
                        $this.attr('_left', moveX);
                    } else {
                        return;
                    }
                    if (moveX < 0) {
                        $this.css({
                            left: "0"
                        });
                        $this.attr('_left', 0);
                    }
                    if (moveX > (pw - thisWidth)) {
                        $this.css({
                            left: pw - thisWidth
                        });
                        $this.attr('_left', pw - thisWidth);
                    }
                    if (moveY < 0) {
                        $this.css({
                            top: "0"
                        });
                        $this.attr('_top', 0);
                    }
                    if (moveY > (ph - thisHeight)) {
                        $this.css({
                            top: ph - thisHeight
                        });
                        $this.attr('_top', ph - thisHeight);
                    }
                });
            };
            /**
             * 定义扩展方法
             * @param key
             * @param opts
             */
            $.fn.extend = function (key, opts) {
                var _this = this;
                if (key == undefined || typeof key != 'string') {
                    init(_this);
                } else {
                    if ($('.item').length == 0) init(_this);
                    return fire(key, _this, opts);
                }
            }
            /**
             * 初始化方法
             */
            var init = function () {

                container = $('#container');

                // 绑定关闭事件
                container.on('click', 'a', function () {
                    if (window.confirm('确定要删除当前标记吗?')) {
                        $(this).parent().remove();
                    }
                }).on('dblclick', '.item', function () {
                    if (window.confirm('确定要删除当前标记吗?')) {
                        $(this).remove();
                    }
                }).height($(window).height() - 5);

                //加载数据
                loadData({ data: JSON.parse(localStorage.getItem('labelArr')) });

                //create
                $('#btn_TXT').click(function () {
                    createItem({
                        text: '文本'
                    });
                });

                $('.demo').click(function () {
                    createItem({ text: './icons/' + $(this).attr("data-src") });
                });

                //clear
                $('#btnClear').click(function () {
                    clear();
                    $('#btnSave').click();
                });

                //save
                $('#btnSave').click(function () {
                    var data = getData();
                    localStorage.setItem('labelArr', JSON.stringify(data));
                });
            };

            $(function () {
                init();
            });
        })(jQuery);
    </script>
    <script type="text/javascript">
        document.oncontextmenu = function () { return false; };
    </script>
</body>
</html> 